# Create Environment Variables lab user
# This is built by removing the ttyd port from the AVL_PRIMARY_CONTAINER_EXTERNAL_DOMAIN 
# and then prepending the kong manager port.
shopt -s extglob # Enable extended globing fot the +() syntax below
export AVL_PRIMARY_CONTAINER_EXTERNAL_DOMAIN_BASE=${AVL_PRIMARY_CONTAINER_EXTERNAL_DOMAIN##+([[:digit:]])}
export AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE=${AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN##+([[:digit:]])}
shopt -u extglob # Disable again as it's resouce heavy

KUMA_GUI_PORT=30001
KUMA_MESH_GUI_HOSTNAME=${KUMA_GUI_PORT}${AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE}
export KUMA_MESH_GUI_URI="https://${KUMA_MESH_GUI_HOSTNAME}/gui"
export KONG_MESH_GUI=${KUMA_MESH_GUI_URI}

KONG_SERVICE_PORT=31112
KONG_SERVICE_HOSTNAME=${KONG_SERVICE_PORT}${AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE}
export KUMA_DEMO_PROXY="https://${KONG_SERVICE_HOSTNAME}"
export PROXY_URL="https://${KONG_SERVICE_HOSTNAME}"
export PROXY_IP=$(getent hosts ${AVL_PAIRED_CONTAINER_INTERNAL_DOMAIN} | awk '{ print $1 "\tdocker" }')

GRAFANA_DASHBOARD_PORT=30004
GRAFANA_DASHBOARD_HOSTNAME=${GRAFANA_DASHBOARD_PORT}${AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE}
export GRAFANA_DASHBOARD="https://${GRAFANA_DASHBOARD_HOSTNAME}"

# Env for Mesh Operations Course portforward access to Demo App.
MESH_DEMO_LOCAL_PORT=8080
MESH_DEMO_LOCAL_HOSTNAME=${MESH_DEMO_LOCAL_PORT}${AVL_PRIMARY_CONTAINER_EXTERNAL_DOMAIN_BASE}
export KONG_MESH_DEMO="https://{MESH_DEMO_LOCAL_HOSTNAME}"

export KONG_SERVICE_HOSTNAME=30000$AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE
export KONG_PORTAL_GUI_HOST=30003$AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE
export KONG_PROXY_URI=30000$AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE
export KONG_SERVICE_URI=30000$AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE
export KONG_MANAGER_URI=30002$AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE
export KONG_PORTAL_API_URI=30004$AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE
export KONG_ADMIN_API_URI=30001$AVL_PAIRED_CONTAINER_EXTERNAL_DOMAIN_BASE

export KUBECONFIG=${HOME}/.kube/config
alias k=kubectl